<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>检查是否有未配置的 词条 数据</title>
  <script type="module" src="./banished.js"></script>
  <script type="module" src="./entries.js"></script>
  <link rel="stylesheet" href="../css/style.css">
</head>

<body>
  <header>
    <h1>检查是否有未配置的 词条 数据</h1>
  </header>

  <main>
    <div id="result"></div>
  </main>

  <footer>
    <p>&copy; 2023 Banished Test</p>
  </footer>

  <script type="module">
    import { BANISHED_HEROES, BANISHED_UNITS, BANISHED_SPELLS, BANISHED_EQUIPMENTS, BANISHED_ROOMS } from "./banished.js"
    import { ENTRIES } from "./entries.js"

    function checkEntitiesInData(dataArray, entityArray) {
      const regex = /\[(.*?)\]/g;
      const entitiesNotFound = new Set();
      const entitiesCreated = [];

      entityArray.forEach(entity => {
        if (!entity || !entity.name) { return; }
        entitiesCreated.push(entity.name);
      });
      dataArray.forEach(itemList => {
        if (!itemList) { return; }

        itemList.forEach(item => {
          if (!item || !item.effect) { return; }

          const it = item.effect.matchAll(regex)
          for (const match of it) {
            if (entitiesCreated.indexOf(match[1]) == -1) {
              entitiesNotFound.add(match[0]);
            }
          };
        });
      });
      return Array.from(entitiesNotFound).sort();
    }

    document.addEventListener('DOMContentLoaded', () => {
      const data = [BANISHED_HEROES, BANISHED_UNITS, BANISHED_SPELLS, BANISHED_EQUIPMENTS, BANISHED_ROOMS,];
      document.getElementById("result").innerHTML = "<h2>未找到的词条数据: </h2>" + checkEntitiesInData(data, ENTRIES).map(entry => "<li>" + entry + "</li>").join("");
    });
  </script>

</body>

</html>